<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>SmartQala ‚Äî –ü–æ–ª–µ–≤–æ–π —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ PRO</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet"/>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<style>
:root{
--bg:#f4f9ff;
--accent:#4DA6FF;
--dark:#1E88E5;
--danger:#E74C3C;
--medium:#F39C12;
--low:#2ECC71;
}
*{box-sizing:border-box;font-family:Inter,sans-serif;}
body{margin:0;background:var(--bg);}
header{
background:white;
padding:20px 40px;
display:flex;
justify-content:space-between;
align-items:center;
box-shadow:0 4px 12px rgba(0,0,0,0.05);
}
.logo{font-weight:800;color:var(--dark);}
.container{padding:40px;}
.grid{
display:grid;
grid-template-columns:2fr 1fr;
gap:30px;
}
.card{
background:white;
padding:20px;
border-radius:16px;
box-shadow:0 8px 24px rgba(0,0,0,0.06);
margin-bottom:20px;
}
.task{
padding:12px;
border-left:6px solid;
border-radius:10px;
margin-bottom:10px;
cursor:pointer;
}
.high{border-color:var(--danger);}
.medium{border-color:var(--medium);}
.low{border-color:var(--low);}
button{
padding:10px 15px;
border:none;
border-radius:10px;
background:var(--dark);
color:white;
cursor:pointer;
margin-top:8px;
}
#map{height:300px;border-radius:14px;margin-top:10px;}
.timer{font-size:20px;font-weight:600;margin:10px 0;}
.kpi{font-size:28px;font-weight:800;color:var(--dark);}
input{width:100%;margin:6px 0;}
</style>
</head>

<body>

<header>
<div class="logo">SmartQala ‚Äî –ü–æ–ª–µ–≤–æ–π —Å–æ—Ç—Ä—É–¥–Ω–∏–∫</div>
<div id="employeeInfo"></div>
</header>

<div class="container">
<div class="grid">

<div>

<div class="card">
<h3>üìã –ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏</h3>
<div id="taskList"></div>
<button onclick="addNewTask()">‚ûï –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –∑–∞–¥–∞—á—É</button>
</div>

<div class="card">
<h3>üó∫ –ù–∞–≤–∏–≥–∞—Ü–∏—è</h3>
<div id="map"></div>
<button onclick="buildRoute()">–ü—Ä–æ–ª–æ–∂–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç</button>
</div>

<div class="card">
<h3>‚è± –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ</h3>
<div class="timer" id="timer">00:00:00</div>

<label>–§–æ—Ç–æ –î–û:</label>
<input type="file" id="beforePhoto" accept="image/*">

<label>–§–æ—Ç–æ –ü–û–°–õ–ï:</label>
<input type="file" id="afterPhoto" accept="image/*">

<button onclick="startTask()">–ù–∞—á–∞—Ç—å</button>
<button onclick="finishTask()">–ó–∞–≤–µ—Ä—à–∏—Ç—å</button>
</div>

</div>

<div>

<div class="card">
<h3>‚≠ê KPI</h3>
<div class="kpi" id="kpi">0%</div>
<p>–í—ã–ø–æ–ª–Ω–µ–Ω–æ —Å–µ–≥–æ–¥–Ω—è: <span id="todayCount">0</span></p>
</div>

<div class="card">
<h3>‚úÖ –ó–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏</h3>
<div id="completedTasks"></div>
</div>

</div>

</div>
</div>

<script>

let tasks = JSON.parse(localStorage.getItem("activeTasks")) || [
{id:1,title:"–Ø–º–∞ –Ω–∞ –¥–æ—Ä–æ–≥–µ",priority:"high",lat:50.4111,lng:80.2275,sla:60,status:"new"},
{id:2,title:"–û—Å–≤–µ—â–µ–Ω–∏–µ",priority:"medium",lat:50.415,lng:80.22,sla:120,status:"new"}
];

let completedTasks = JSON.parse(localStorage.getItem("completedTasks")) || [];

let selectedTask = null;
let startTime = null;
let interval = null;

const map = L.map('map').setView([50.4111,80.2275],13);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

let marker;
let routeLayer;

function renderTasks(){
const container=document.getElementById("taskList");
container.innerHTML="";

tasks.forEach(t=>{
   const div=document.createElement("div");
   div.className="task "+t.priority;
   div.innerHTML=`
<strong>${t.title}</strong><br>
–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: ${t.priority}<br>
SLA: ${t.sla} –º–∏–Ω<br>
–°—Ç–∞—Ç—É—Å: ${t.status}
   `;
   div.onclick=()=>selectTask(t);
   container.appendChild(div);
});

localStorage.setItem("activeTasks", JSON.stringify(tasks));
}

renderTasks();

function selectTask(task){
selectedTask=task;
if(marker) map.removeLayer(marker);
marker=L.marker([task.lat,task.lng]).addTo(map);
map.setView([task.lat,task.lng],15);
}

async function buildRoute(){
if(!selectedTask){alert("–í—ã–±–µ—Ä–∏—Ç–µ –∑–∞–¥–∞—á—É");return;}

const startLng = 80.2275;
const startLat = 50.4111;

const url = `https://router.project-osrm.org/route/v1/driving/${startLng},${startLat},${selectedTask.lng},${selectedTask.lat}?overview=full&geometries=geojson`;

try{
const res = await fetch(url);
const data = await res.json();

if(routeLayer) map.removeLayer(routeLayer);

routeLayer = L.geoJSON(data.routes[0].geometry).addTo(map);
map.fitBounds(routeLayer.getBounds());
}catch(e){
alert("–û—à–∏–±–∫–∞ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –º–∞—Ä—à—Ä—É—Ç–∞");
}
}

function startTask(){
if(!selectedTask){alert("–í—ã–±–µ—Ä–∏—Ç–µ –∑–∞–¥–∞—á—É");return;}
startTime=new Date();
selectedTask.status="in_progress";

interval=setInterval(()=>{
   const sec=Math.floor((new Date()-startTime)/1000);
   const h=String(Math.floor(sec/3600)).padStart(2,"0");
   const m=String(Math.floor((sec%3600)/60)).padStart(2,"0");
   const s=String(sec%60).padStart(2,"0");
   document.getElementById("timer").innerText=`${h}:${m}:${s}`;
},1000);

renderTasks();
}

function finishTask(){
const before=document.getElementById("beforePhoto").files[0];
const after=document.getElementById("afterPhoto").files[0];

if(!before||!after){alert("–§–æ—Ç–æ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã");return;}
if(!startTime){alert("–°–Ω–∞—á–∞–ª–∞ –Ω–∞—á–Ω–∏—Ç–µ –∑–∞–¥–∞—á—É");return;}

clearInterval(interval);

const duration=(new Date()-startTime)/60000;

const completed={
   ...selectedTask,
   duration:duration,
   date:new Date().toLocaleDateString()
};

completedTasks.push(completed);
tasks = tasks.filter(t=>t.id!==selectedTask.id);

localStorage.setItem("activeTasks", JSON.stringify(tasks));
localStorage.setItem("completedTasks", JSON.stringify(completedTasks));

updateKPI();
renderTasks();
renderCompleted();

selectedTask=null;
startTime=null;
document.getElementById("timer").innerText="00:00:00";
document.getElementById("beforePhoto").value="";
document.getElementById("afterPhoto").value="";
if(marker) map.removeLayer(marker);
if(routeLayer) map.removeLayer(routeLayer);

alert("–ó–∞–¥–∞—á–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞");
}

function renderCompleted(){
const container=document.getElementById("completedTasks");
container.innerHTML="";

completedTasks.forEach(t=>{
   const div=document.createElement("div");
   div.style.borderBottom="1px solid #eee";
   div.style.padding="8px 0";
   div.innerHTML=`
<strong>${t.title}</strong><br>
‚è± ${t.duration.toFixed(1)} –º–∏–Ω<br>
üìÖ ${t.date}
   `;
   container.prepend(div);
});
}

renderCompleted();

function updateKPI(){
const today=new Date().toLocaleDateString();
const todayTasks=completedTasks.filter(t=>t.date===today);
document.getElementById("todayCount").innerText=todayTasks.length;

let score=Math.min(todayTasks.length*20,100);
document.getElementById("kpi").innerText=score+"%";
}

function addNewTask(){
const id=Date.now();
const newTask={
   id:id,
   title:"–ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞ "+id,
   priority:["high","medium","low"][Math.floor(Math.random()*3)],
   lat:50.41 + Math.random()/100,
   lng:80.22 + Math.random()/100,
   sla:60,
   status:"new"
};
tasks.push(newTask);
renderTasks();
}

updateKPI();

</script>

</body>
</html>

 

 
