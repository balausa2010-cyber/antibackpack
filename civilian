<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>SmartQala ‚Äî –¶–∏—Ñ—Ä–æ–≤–æ–π –≥–æ—Ä–æ–¥</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet"/>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<style>
:root{
    --bg:#f4f9ff;
    --accent:#4DA6FF;
    --accent-dark:#1E88E5;
    --danger:#E74C3C;
    --text:#0F2A43;
}
*{box-sizing:border-box;font-family:Inter,sans-serif;}
body{margin:0;background:var(--bg);color:var(--text);}
header{
    background:white;
    padding:20px 60px;
    display:flex;
    justify-content:space-between;
    align-items:center;
    box-shadow:0 4px 12px rgba(0,0,0,0.05);
    position:sticky;
    top:0;
    z-index:100;
}
.logo{font-weight:800;font-size:22px;color:var(--accent-dark);}
nav{display:flex;gap:25px;}
nav button{background:none;border:none;font-size:15px;font-weight:500;cursor:pointer;}
nav button.active{color:var(--accent-dark);font-weight:700;}
.hero{padding:100px 60px;background:linear-gradient(120deg,#4DA6FF,#1E88E5);color:white;}
.hero h1{font-size:44px;margin:0 0 20px 0;}
.hero p{max-width:650px;font-size:18px;opacity:0.95;}
.section{display:none;padding:60px;min-height:80vh;}
.section.active{display:block;}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:30px;}
.card{background:white;padding:30px;border-radius:18px;box-shadow:0 8px 24px rgba(0,0,0,0.06);margin-bottom:20px;}
.list-item{display:flex;justify-content:space-between;padding:12px 0;border-bottom:1px solid #eee;}
.notification{padding:15px;background:#fff;border-left:5px solid #E1BD72;border-radius:12px;margin-bottom:15px;}
.emergency-box{padding:25px;border-radius:18px;background:#fff4f4;border-left:6px solid var(--danger);}
button.primary{background:var(--accent-dark);color:white;padding:12px 20px;border:none;border-radius:12px;margin-top:15px;cursor:pointer;}
footer{background:white;padding:30px 60px;text-align:center;font-size:14px;color:#666;}
@media(max-width:768px){
    header{padding:20px;}
    .hero{padding:60px 20px;}
    .section{padding:40px 20px;}
    .hero h1{font-size:28px;}
}
</style>
</head>
<body>

<header>
    <div class="logo">SmartQala</div>
    <nav>
        <button onclick="showTab(event,'home')" class="active" data-lang-key="home">–ì–ª–∞–≤–Ω–∞—è</button>
        <button onclick="showTab(event,'profile')" data-lang-key="profile">–ü—Ä–æ—Ñ–∏–ª—å</button>
        <button onclick="showTab(event,'complaints')" data-lang-key="complaints">–û–±—Ä–∞—â–µ–Ω–∏—è</button>
        <button onclick="showTab(event,'notifications')" data-lang-key="notifications">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</button>
        <button onclick="showTab(event,'emergency')" data-lang-key="emergency">Emergency</button>
        <button onclick="showTab(event,'voting')" data-lang-key="voting">–ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ</button>
        <button onclick="showTab(event,'shop')" data-lang-key="shop">–ú–∞–≥–∞–∑–∏–Ω</button>
        <select id="langSelect" style="margin-left:20px;padding:5px;">
            <option value="ru">RU</option>
            <option value="kz">KZ</option>
            <option value="en">EN</option>
        </select>
    </nav>
</header>

<!-- –ì–ª–∞–≤–Ω–∞—è -->
<section id="home" class="section active">
    <div class="hero">
        <h1 data-lang-key="heroTitle">–¶–∏—Ñ—Ä–æ–≤–æ–π –≥–æ—Ä–æ–¥ –±—É–¥—É—â–µ–≥–æ</h1>
        <p data-lang-key="heroText">SmartQala ‚Äî –µ–¥–∏–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –æ–±—Ä–∞—â–µ–Ω–∏—è –≥—Ä–∞–∂–¥–∞–Ω, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –≥–æ—Ä–æ–¥—Å–∫–æ–π —Å—Ä–µ–¥—ã –∏ —ç–∫—Å—Ç—Ä–µ–Ω–Ω–æ–≥–æ –∏–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è.</p>
    </div>

    <div class="grid" style="margin-top:40px;">
        <div class="card">
            <h3 data-lang-key="card1Title">üì© 24/7 –û–±—Ä–∞—â–µ–Ω–∏—è</h3>
            <p data-lang-key="card1Text">–°–æ–æ–±—â–∞–π—Ç–µ –æ –ø—Ä–æ–±–ª–µ–º–∞—Ö –≥–æ—Ä–æ–¥–∞ –≤ –ª—é–±–æ–µ –≤—Ä–µ–º—è.</p>
        </div>
        <div class="card">
            <h3 data-lang-key="card2Title">üìä –ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å</h3>
            <p data-lang-key="card2Text">–û—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ —Å—Ç–∞—Ç—É—Å –≤–∞—à–∏—Ö –∑–∞—è–≤–æ–∫ –∏ —ç—Ç–∞–ø—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏.</p>
        </div>
        <div class="card">
            <h3 data-lang-key="card3Title">üö® –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</h3>
            <p data-lang-key="card3Text">–ü–æ–ª—É—á–∞–π—Ç–µ —ç–∫—Å—Ç—Ä–µ–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.</p>
        </div>
    </div>
</section>

<!-- –ü—Ä–æ—Ñ–∏–ª—å -->
<section id="profile" class="section">
    <div class="card">
        <h2 data-lang-key="profileTitle">–õ–∏—á–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å</h2>
        <p><strong data-lang-key="nameLabel">–§–ò–û:</strong> –ê–∏–¥–∞ –û—Ä–∞–ª–±–µ–∫–æ–≤–∞</p>
        <p><strong data-lang-key="iinLabel">–ò–ò–ù:</strong> 990101123456</p>
        <p><strong data-lang-key="phoneLabel">–¢–µ–ª–µ—Ñ–æ–Ω:</strong> +7 707 123 45 67</p>
        <p><strong data-lang-key="egovLabel">eGov:</strong> –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω</p>
    </div>
    <div class="card">
        <h2 data-lang-key="mapProblemsTitle">–ü—Ä–æ–±–ª–µ–º—ã —Ä–∞–π–æ–Ω–∞</h2>
        <div id="profileMap" style="height:400px;border-radius:15px;"></div>
    </div>
</section>

<!-- –û–±—Ä–∞—â–µ–Ω–∏—è -->
<section id="complaints" class="section">
    <div class="card">
        <h2 data-lang-key="complaintTitle">–ü–æ–¥–∞—Ç—å –æ–±—Ä–∞—â–µ–Ω–∏–µ</h2>
        <form id="complaintForm">
            <label data-lang-key="categoryLabel"><strong>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</strong></label><br><br>
            <select id="category" required style="width:100%;padding:12px;border-radius:10px;border:1px solid #ddd;">
                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–±–ª–µ–º—É</option>
                <option>–Ø–º—ã –Ω–∞ –¥–æ—Ä–æ–≥–µ</option>
                <option>–ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Å–≤–µ—â–µ–Ω–∏–µ</option>
                <option>–ú—É—Å–æ—Ä –≤–æ –¥–≤–æ—Ä–µ</option>
                <option>–ü—Ä–æ–±–ª–µ–º—ã —Å —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–æ–º</option>
                <option>–ù–µ—Ç –æ—Ç–æ–ø–ª–µ–Ω–∏—è</option>
                <option>–ü—Ä–æ–±–ª–µ–º—ã —Å –≤–æ–¥–æ–π</option>
                <option>–ó–∞—Ç–æ—Ä—ã –∏ –ø—Ä–æ–±–∫–∏</option>
                <option>–ü–ª–æ—Ö–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ç—Ä–æ—Ç—É–∞—Ä–æ–≤</option>
                <option>–ù–µ —Ä–∞–±–æ—Ç–∞—é—Ç —Å–≤–µ—Ç–æ—Ñ–æ—Ä—ã</option>
                <option>–ü–æ–≤—Ä–µ–∂–¥–µ–Ω–∞ –¥–µ—Ç—Å–∫–∞—è –ø–ª–æ—â–∞–¥–∫–∞</option>
                <option>–ü—Ä–æ–±–ª–µ–º—ã —Å –ø–∞—Ä–∫–æ–≤–∫–æ–π</option>
                <option>–®—É–º –∏ –∑–∞–≥—Ä—è–∑–Ω–µ–Ω–∏–µ</option>
                <option>–ù–µ—É–¥–æ–±–Ω—ã–π –¥–æ—Å—Ç—É–ø –¥–ª—è –ª—é–¥–µ–π —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–º–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º–∏</option>
                <option>–û–±—Ä—É—à–µ–Ω–∏—è –∑–¥–∞–Ω–∏–π</option>
                <option>–ü–æ–≤—Ä–µ–∂–¥–µ–Ω–∏–µ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã</option>
                <option>–ó–∞–±—Ä–æ—à–µ–Ω–Ω—ã–µ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏</option>
                <option>–î—Ä—É–≥–æ–µ</option>
            </select>
            <br><br>
            <div id="manualProblemDiv" style="display:none; margin-bottom:15px;">
                <label data-lang-key="manualLabel"><strong>–£–∫–∞–∂–∏—Ç–µ —Å–≤–æ—é –ø—Ä–æ–±–ª–µ–º—É:</strong></label><br>
                <input type="text" id="manualProblem" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ –ø—Ä–æ–±–ª–µ–º—É" style="width:100%;padding:12px;border-radius:10px;border:1px solid #ddd;">
            </div>
            <div id="selectedProblem" style="margin-bottom:15px;font-weight:600;"></div>
            <label data-lang-key="addressLabel"><strong>–ê–¥—Ä–µ—Å (—É–ª–∏—Ü–∞, –¥–æ–º):</strong></label><br><br>
            <input type="text" id="address" required placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: —É–ª. –ê–±–∞—è, 25" style="width:100%;padding:12px;border-radius:10px;border:1px solid #ddd;">
            <br><br>
            <label data-lang-key="mapLabel"><strong>–û—Ç–º–µ—Ç—å—Ç–µ —Ç–æ—á–∫—É –Ω–∞ –∫–∞—Ä—Ç–µ:</strong></label>
            <div id="map" style="height:300px;border-radius:15px;margin-top:15px;"></div>
            <br>
            <label data-lang-key="descLabel"><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong></label>
            <textarea id="description" rows="4" required style="width:100%;padding:12px;border-radius:10px;border:1px solid #ddd;" placeholder="–û–ø–∏—à–∏—Ç–µ –ø—Ä–æ–±–ª–µ–º—É"></textarea>
            <br><br>
            <button type="submit" class="primary" data-lang-key="sendBtn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
        </form>
    </div>
    <div class="card">
        <h2 data-lang-key="historyTitle">–ò—Å—Ç–æ—Ä–∏—è –æ–±—Ä–∞—â–µ–Ω–∏–π</h2>
        <div id="history"></div>
    </div>
</section>

<!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
<section id="notifications" class="section">
    <div class="card">
        <h2 data-lang-key="notificationsTitle">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</h2>
        <div id="notificationList"></div>
    </div>
</section>

<!-- Emergency -->
<section id="emergency" class="section">
    <div class="card emergency-box">
        <h2 data-lang-key="emergencyTitle">üö® –≠–∫—Å—Ç—Ä–µ–Ω–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h2>
        <div id="weatherInfo">–ó–∞–≥—Ä—É–∑–∫–∞ –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö...</div>
        <div id="dangerLevel" style="margin-top:10px;font-weight:600;"></div>
    </div>
</section>

<!-- –ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ -->
<section id="voting" class="section">
    <div class="card">
        <h2 data-lang-key="votingTitle">üèõ –ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ –∑–∞ –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –≥–æ—Ä–æ–¥–∞</h2>
        <form id="votingForm">
            <label data-lang-key="voteLabel"><strong>–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–±–ª–µ–º—É:</strong></label><br><br>
            <select id="voteCategory" required style="width:100%;padding:12px;border-radius:10px;border:1px solid #ddd;">
                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–±–ª–µ–º—É</option>
                <option>–Ø–º—ã –Ω–∞ –¥–æ—Ä–æ–≥–µ</option>
                <option>–ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Å–≤–µ—â–µ–Ω–∏–µ</option>
                <option>–ú—É—Å–æ—Ä –≤–æ –¥–≤–æ—Ä–µ</option>
                <option>–ü—Ä–æ–±–ª–µ–º—ã —Å —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–æ–º</option>
                <option>–ù–µ—Ç –æ—Ç–æ–ø–ª–µ–Ω–∏—è</option>
                <option>–ü—Ä–æ–±–ª–µ–º—ã —Å –≤–æ–¥–æ–π</option>
                <option>–ó–∞—Ç–æ—Ä—ã –∏ –ø—Ä–æ–±–∫–∏</option>
                <option>–ü–ª–æ—Ö–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ç—Ä–æ—Ç—É–∞—Ä–æ–≤</option>
                <option>–ù–µ —Ä–∞–±–æ—Ç–∞—é—Ç —Å–≤–µ—Ç–æ—Ñ–æ—Ä—ã</option>
                <option>–ü–æ–≤—Ä–µ–∂–¥–µ–Ω–∞ –¥–µ—Ç—Å–∫–∞—è –ø–ª–æ—â–∞–¥–∫–∞</option>
                <option>–ü—Ä–æ–±–ª–µ–º—ã —Å –ø–∞—Ä–∫–æ–≤–∫–æ–π</option>
                <option>–®—É–º –∏ –∑–∞–≥—Ä—è–∑–Ω–µ–Ω–∏–µ</option>
                <option>–ù–µ—É–¥–æ–±–Ω—ã–π –¥–æ—Å—Ç—É–ø –¥–ª—è –ª—é–¥–µ–π —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–º–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º–∏</option>
                <option>–û–±—Ä—É—à–µ–Ω–∏—è –∑–¥–∞–Ω–∏–π</option>
                <option>–ü–æ–≤—Ä–µ–∂–¥–µ–Ω–∏–µ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã</option>
                <option>–ó–∞–±—Ä–æ—à–µ–Ω–Ω—ã–µ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏</option>
                <option>–î—Ä—É–≥–æ–µ</option>
            </select>
            <br><br>
            <label data-lang-key="districtLabel"><strong>–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–π–æ–Ω:</strong></label><br><br>
            <select id="voteDistrict" style="width:100%;padding:12px;border-radius:10px;border:1px solid #ddd;">
                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–π–æ–Ω</option>
                <option>–ú–∏—Ä–Ω—ã–π</option>
                <option>–í–æ—Å—Ç–æ—á–Ω—ã–π –õ–µ–≤—ã–π</option>
                <option>–í–æ—Å—Ç–æ—á–Ω—ã–π –ü—Ä–∞–≤—ã–π</option>
                <option>–°–æ–≥—Ä–∞</option>
                <option>–ü—Ç–∏—á–Ω–∏–∫</option>
                <option>–ì—Ä—è–∑–Ω—É—Ö–∞</option>
                <option>–ë–æ–ª—å—à–æ–π</option>
                <option>–ú—É—Ä–∞—Ç</option>
                <option>–í–æ–¥–Ω—ã–π</option>
                <option>–ë–æ–±—Ä–æ–≤–∫–∞</option>
                <option>–ü—Ä–æ–º—ã—à–ª–µ–Ω–Ω—ã–µ –∑–æ–Ω—ã</option>
                <option>–ü—Ä–∏—Ä–æ–¥–Ω—ã–µ –∏ —Ä–µ–∫—Ä–µ–∞—Ü–∏–æ–Ω–Ω—ã–µ –∑–æ–Ω—ã</option>
            </select>
            <br><br>
            <button type="submit" class="primary" data-lang-key="voteBtn">–ü—Ä–æ–≥–æ–ª–æ—Å–æ–≤–∞—Ç—å</button>
        </form>
    </div>
    <div class="card">
        <h2 data-lang-key="voteStatsTitle">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è</h2>
        <div id="voteStats"></div>
    </div>
</section>

<!-- –ú–∞–≥–∞–∑–∏–Ω -->
<section id="shop" class="section">
    <div class="card">
        <h2>üõí –ú–∞–≥–∞–∑–∏–Ω –æ—á–∫–æ–≤</h2>
        <p>–í–∞—à–∏ –æ—á–∫–∏: <span id="pointsDisplay">0</span></p>
        <div class="grid" style="margin-top:20px;">
            <div class="card">
                <h3>üéÅ –°—Ç–∏–∫–µ—Ä "–ì–æ—Ä–æ–¥—Å–∫–æ–π –≥–µ—Ä–æ–π"</h3>
                <p>–¶–µ–Ω–∞: 10 –æ—á–∫–æ–≤</p>
                <button class="primary" onclick="buyItem('–°—Ç–∏–∫–µ—Ä')">–ö—É–ø–∏—Ç—å</button>
            </div>
            <div class="card">
                <h3>üèÜ –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –ø—Ä–æ–µ–∑–¥ –Ω–∞ –∞–≤—Ç–æ–±—É—Å–µ –Ω–∞ –º–µ—Å—è—Ü</h3>
                <p>–¶–µ–Ω–∞: 20 –æ—á–∫–æ–≤</p>
                <button class="primary" onclick="buyItem('–¢—Ä–æ—Ñ–µ–π')">–ö—É–ø–∏—Ç—å</button>
            </div>
            <div class="card">
                <h3>üåü –ó–≤–∞–Ω–∏–µ "–ì–µ—Ä–æ–π –≥–æ—Ä–æ–¥–∞"</h3>
                <p>–¶–µ–Ω–∞: 30 –æ—á–∫–æ–≤</p>
                <button class="primary" onclick="buyItem('–ü—Ä–µ–º–∏—É–º-–∑–Ω–∞—á–æ–∫')">–ö—É–ø–∏—Ç—å</button>
            </div>
        </div>
        <div id="shopHistory" style="margin-top:20px;font-weight:600;"></div>
    </div>
</section>

<footer>
¬© 2026 SmartQala ‚Äî Digital City Platform
</footer>

<script>
/* --- –í–∫–ª–∞–¥–∫–∏ --- */
function showTab(e,id){
    document.querySelectorAll(".section").forEach(s=>s.classList.remove("active"));
    document.querySelectorAll("nav button").forEach(b=>b.classList.remove("active"));
    document.getElementById(id).classList.add("active");
    e.target.classList.add("active");
    setTimeout(()=>{ if(map) map.invalidateSize(); if(profileMap) profileMap.invalidateSize(); },100);
}

/* --- –Ø–∑—ã–∫–∏ --- */
const translations={
    ru:{home:"–ì–ª–∞–≤–Ω–∞—è", profile:"–ü—Ä–æ—Ñ–∏–ª—å", complaints:"–û–±—Ä–∞—â–µ–Ω–∏—è", notifications:"–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è", emergency:"Emergency", voting:"–ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ", shop:"–ú–∞–≥–∞–∑–∏–Ω"},
    kz:{home:"–ë–∞—Å—Ç—ã –±–µ—Ç", profile:"–ü—Ä–æ—Ñ–∏–ª—å", complaints:"–ú”©—Ä–¥–µ—É–ª–µ—Ä", notifications:"–•–∞–±–∞—Ä–ª–∞–º–∞–ª–∞—Ä", emergency:"–¢”©—Ç–µ–Ω—à–µ –∂–∞“ì–¥–∞–π", voting:"–î–∞—É—ã—Å –±–µ—Ä—É", shop:"–î“Ø–∫–µ–Ω"},
    en:{home:"Home", profile:"Profile", complaints:"Complaints", notifications:"Notifications", emergency:"Emergency", voting:"Voting", shop:"Shop"}
};
function updateLanguage(lang){
    document.querySelectorAll("nav button").forEach(btn=>{
        let key = btn.getAttribute("data-lang-key");
        if(translations[lang][key]) btn.innerText = translations[lang][key];
    });
}
document.getElementById("langSelect").addEventListener("change",e=>updateLanguage(e.target.value));
updateLanguage("ru");

/* --- –ö–∞—Ä—Ç—ã --- */
let map = L.map('map').setView([50.416, 80.253], 13);
L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19}).addTo(map);
let marker;
map.on('click',e=>{ if(marker) map.removeLayer(marker); marker=L.marker(e.latlng).addTo(map); });

let profileMap = L.map('profileMap').setView([50.416, 80.253], 13);
L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19}).addTo(profileMap);
L.marker([50.418,80.257]).bindPopup("–Ø–º—ã –Ω–∞ –¥–æ—Ä–æ–≥–µ").addTo(profileMap);
L.marker([50.414,80.248]).bindPopup("–ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Å–≤–µ—â–µ–Ω–∏–µ").addTo(profileMap);

/* --- –û–±—Ä–∞—â–µ–Ω–∏—è --- */
document.getElementById("category").addEventListener("change",e=>{
    if(e.target.value==="–î—Ä—É–≥–æ–µ") document.getElementById("manualProblemDiv").style.display="block";
    else document.getElementById("manualProblemDiv").style.display="none";
    document.getElementById("selectedProblem").innerText=e.target.value;
});
const historyList=[];
function renderHistory(){
    document.getElementById("history").innerHTML=historyList.map(h=>`<div class="list-item"><strong>${h.cat}</strong> ‚Äî ${h.desc} (${h.addr}) ${h.latlng}</div>`).join('');
}
document.getElementById("complaintForm").addEventListener("submit",e=>{
    e.preventDefault();
    let cat=document.getElementById("category").value;
    let desc=document.getElementById("description").value;
    let addr=document.getElementById("address").value;
    let latlng=marker?`(${marker.getLatLng().lat.toFixed(3)},${marker.getLatLng().lng.toFixed(3)})`:'–Ω–µ –≤—ã–±—Ä–∞–Ω–æ';
    historyList.push({cat,desc,addr,latlng});
    renderHistory();
    alert("–û–±—Ä–∞—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!");
    e.target.reset();
    if(marker){map.removeLayer(marker); marker=null;}
    points +=5; updatePointsDisplay();
});

/* --- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è --- */
const notifications=["–î–æ—Ä–æ–≥–∞ –Ω–∞ —É–ª. –ê–±–∞—è –æ—Ç—Ä–µ–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞","–ü—Ä–æ–±–ª–µ–º—ã —Å –æ—Å–≤–µ—â–µ–Ω–∏–µ–º —É—Å—Ç—Ä–∞–Ω–µ–Ω—ã"];
document.getElementById("notificationList").innerHTML=notifications.map(n=>`<div class="notification">${n}</div>`).join('');

/* --- Emergency --- */
document.getElementById("weatherInfo").innerText="–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: -5¬∞C, —Å–Ω–µ–≥, –≤–µ—Ç–µ—Ä 4–º/—Å";
document.getElementById("dangerLevel").innerText="–£—Ä–æ–≤–µ–Ω—å –æ–ø–∞—Å–Ω–æ—Å—Ç–∏: –≤—ã—Å–æ–∫–∏–π";

/* --- –ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ --- */
const votes={};
document.getElementById("votingForm").addEventListener("submit",e=>{
    e.preventDefault();
    let prob=document.getElementById("voteCategory").value;
    let district=document.getElementById("voteDistrict").value;
    if(!prob||!district){alert("–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–±–ª–µ–º—É –∏ —Ä–∞–π–æ–Ω"); return;}
    let key=`${prob} ‚Äî ${district}`;
    votes[key]=votes[key]?votes[key]+1:1;
    renderVotes();
    alert("–í–∞—à –≥–æ–ª–æ—Å —É—á—Ç—ë–Ω!");
    points +=5; updatePointsDisplay();
});
function renderVotes(){
    document.getElementById("voteStats").innerHTML=Object.keys(votes).map(k=>`<div class="list-item">${k}: ${votes[k]}</div>`).join('');
}

/* --- –ú–∞–≥–∞–∑–∏–Ω --- */
let points = 0;
function updatePointsDisplay(){ document.getElementById("pointsDisplay").innerText = points; }
function buyItem(item){
    const prices = {"–°—Ç–∏–∫–µ—Ä":10,"–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –ø—Ä–æ–µ–∑–¥ –Ω–∞ –∞–≤—Ç–æ–±—É—Å–µ –Ω–∞ –º–µ—Å—è—Ü":20,"–∑–≤–∞–Ω–∏–µ –ì–µ—Ä–æ–π –≥–æ—Ä–æ–¥–∞":30};
    if(points >= prices[item]){
        points -= prices[item];
        updatePointsDisplay();
        document.getElementById("shopHistory").innerHTML += `<div>–í—ã –∫—É–ø–∏–ª–∏: ${item}</div>`;
        alert(`–í—ã —É—Å–ø–µ—à–Ω–æ –∫—É–ø–∏–ª–∏ ${item}!`);
    } else {
        alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ—á–∫–æ–≤ –¥–ª—è –ø–æ–∫—É–ø–∫–∏!");
    }
}
updatePointsDisplay();
</script>

</body>
</html>
